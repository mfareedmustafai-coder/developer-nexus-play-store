<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Developer Portal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #0f1014; color: #fff; font-family: 'Poppins', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* AUTH SCREEN */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f1014; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .auth-box { background: #1b1e26; padding: 40px; border-radius: 15px; width: 350px; text-align: center; border: 1px solid #333; }
        .auth-box h2 { color: #00d4ff; margin-bottom: 20px; }
        
        /* DASHBOARD */
        #dashboard { display: none; width: 100%; height: 100%; }
        .sidebar { width: 250px; background: #16181c; padding: 20px; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 40px; overflow-y: auto; }

        /* FORMS */
        input, textarea, select { width: 100%; background: #0f1014; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        label { display: block; color: #aaa; margin-bottom: 5px; font-size: 13px; }
        
        .btn { width: 100%; padding: 12px; background: #00d4ff; color: black; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .btn:hover { background: #00a3cc; }
        
        .file-upload { border: 2px dashed #444; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; margin-bottom: 15px; }
        .file-upload:hover { border-color: #00d4ff; }
        
        .status-box { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #00d4ff; }
    </style>
</head>
<body>

    <!-- AUTHENTICATION (Login/Signup) -->
    <div id="auth-screen">
        <div class="auth-box">
            <h2>Developer Portal</h2>
            <div id="login-form">
                <input type="email" id="l-email" placeholder="Email">
                <input type="password" id="l-pass" placeholder="Password">
                <button class="btn" onclick="window.loginDev()">Log In</button>
                <p style="font-size:12px; margin-top:15px; cursor:pointer; color:#aaa;" onclick="window.toggleAuth()">Create Developer Account</p>
            </div>
            <div id="signup-form" style="display:none;">
                <input type="text" id="s-name" placeholder="Developer Name / Studio">
                <input type="email" id="s-email" placeholder="Email">
                <input type="password" id="s-pass" placeholder="Password">
                <button class="btn" onclick="window.createDev()">Create Account</button>
                <p style="font-size:12px; margin-top:15px; cursor:pointer; color:#aaa;" onclick="window.toggleAuth()">Back to Login</p>
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="dashboard">
        <div class="sidebar">
            <h3 style="color:#00d4ff"><i class="fas fa-code"></i> Dev Console</h3>
            <p id="dev-name-display" style="font-size:12px; color:#aaa;">Welcome</p>
            <div style="margin-top:auto">
                <button class="btn" style="background:#ff4757; color:white" onclick="window.logout()">Logout</button>
            </div>
        </div>

        <div class="main">
            <h1>Submit App for Review</h1>
            <div class="status-box">
                <i class="fas fa-info-circle"></i> Your app will be sent to the <b>Admin</b> for approval. Once approved, it will appear in the Nexus Store.
            </div>

            <div style="background:#1b1e26; padding:30px; border-radius:15px; max-width:600px;">
                <label>App Name</label>
                <input type="text" id="appName" placeholder="e.g. My Awesome Game">

                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label>Type</label><select id="appType"><option>Game</option><option>App</option></select></div>
                    <div style="flex:1"><label>Category</label><select id="appCat"><option>Action</option><option>Racing</option><option>RPG</option><option>Tools</option></select></div>
                </div>

                <div style="display:flex; gap:10px;">
                    <div style="flex:1"><label>Size</label><input id="appSize" placeholder="100 MB"></div>
                    <div style="flex:1"><label>Age</label><input id="appAge" placeholder="12+"></div>
                </div>

                <label>Pricing</label>
                <select id="priceType" onchange="window.togglePrice()">
                    <option value="Free">Free</option>
                    <option value="Paid">Paid</option>
                </select>
                <input type="text" id="appPrice" placeholder="Price (e.g. Rs. 500)" disabled style="display:none;">

                <label>Icon</label>
                <div class="file-upload" onclick="document.getElementById('iconFile').click()">
                    <i class="fas fa-upload"></i> Upload Icon
                </div>
                <input type="file" id="iconFile" hidden accept="image/*" onchange="window.handleIcon(this)">
                <input type="hidden" id="iconBase64">
                <img id="iconPreview" style="height:50px; display:none; margin-bottom:10px;">

                <label>Download Link</label>
                <input type="text" id="appLink" placeholder="Google Drive / MediaFire Link">

                <label>Description</label>
                <textarea id="appDesc" rows="3"></textarea>

                <label>Screenshots</label>
                <div id="sc-container"></div>
                <button class="btn" style="background:#333; margin-bottom:10px;" onclick="window.addScField()">+ Add Screenshot</button>

                <button class="btn" onclick="window.submitForReview()">SUBMIT FOR REVIEW</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // --- PASTE YOUR FIREBASE CONFIG HERE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCn1FBaxDwbvC28VWXAcq557uCidl-JHy0",
            authDomain: "app-store-6b5d4.firebaseapp.com",
            databaseURL: "https://app-store-6b5d4-default-rtdb.firebaseio.com",
            projectId: "app-store-6b5d4",
            storageBucket: "app-store-6b5d4.firebasestorage.app",
            messagingSenderId: "55022892860",
            appId: "1:55022892860:web:f48865da1539854bf8d039"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let currentUser = null;

        // AUTH LOGIC
        onAuthStateChanged(auth, u => {
            if(u) {
                currentUser = u;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'flex';
                document.getElementById('dev-name-display').innerText = u.displayName || "Developer";
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        window.toggleAuth = () => {
            const login = document.getElementById('login-form');
            const signup = document.getElementById('signup-form');
            if(login.style.display === 'none') { login.style.display='block'; signup.style.display='none'; }
            else { login.style.display='none'; signup.style.display='block'; }
        };

        window.loginDev = () => {
            const e = document.getElementById('l-email').value;
            const p = document.getElementById('l-pass').value;
            signInWithEmailAndPassword(auth, e, p).catch(e => alert(e.message));
        };

        window.createDev = () => {
            const n = document.getElementById('s-name').value;
            const e = document.getElementById('s-email').value;
            const p = document.getElementById('s-pass').value;
            if(!n) return alert("Name Required");
            createUserWithEmailAndPassword(auth, e, p).then(cred => {
                updateProfile(cred.user, { displayName: n });
            }).catch(err => alert(err.message));
        };

        window.logout = () => signOut(auth);

        // APP SUBMISSION
        const compress = (f) => new Promise(r => { const rd=new FileReader(); rd.readAsDataURL(f); rd.onload=e=>{ const i=new Image(); i.src=e.target.result; i.onload=()=>{ const c=document.createElement('canvas'),s=500/i.width; c.width=500; c.height=i.height*s; c.getContext('2d').drawImage(i,0,0,c.width,c.height); r(c.toDataURL('image/jpeg',0.7))}}});

        window.handleIcon = async (i) => { if(i.files[0]) { const b=await compress(i.files[0]); document.getElementById('iconBase64').value=b; document.getElementById('iconPreview').src=b; document.getElementById('iconPreview').style.display='block'; } };
        
        window.togglePrice = () => {
            const t = document.getElementById('priceType').value;
            const i = document.getElementById('appPrice');
            if(t === 'Paid') { i.style.display = 'block'; i.disabled = false; }
            else { i.style.display = 'none'; i.disabled = true; i.value = ""; }
        };

        window.addScField = () => {
            const d = document.createElement('div');
            d.innerHTML = `<input type="file" class="sc-file" accept="image/*" onchange="window.handleSc(this)" style="margin-bottom:5px">`;
            document.getElementById('sc-container').appendChild(d);
        };
        window.handleSc = async (i) => { if(i.files[0]) { const b=await compress(i.files[0]); i.setAttribute('data-b64', b); i.style.border="1px solid #00d4ff"; } };

        window.submitForReview = () => {
            const name = document.getElementById('appName').value;
            const link = document.getElementById('appLink').value;
            
            if(!name || !link) return alert("Name and Link are required!");

            const screenshots = [];
            document.querySelectorAll('.sc-file').forEach(i => { const v=i.getAttribute('data-b64'); if(v) screenshots.push(v); });

            const appData = {
                name: name,
                type: document.getElementById('appType').value,
                category: document.getElementById('appCat').value,
                size: document.getElementById('appSize').value || "N/A",
                age: document.getElementById('appAge').value || "3+",
                priceType: document.getElementById('priceType').value,
                price: document.getElementById('appPrice').value || "Free",
                logo: document.getElementById('iconBase64').value,
                download: link,
                desc: document.getElementById('appDesc').value,
                screenshots: screenshots,
                developer: currentUser.displayName,
                developerId: currentUser.uid,
                status: "Pending", // IMPORTANT: This goes to Pending
                timestamp: Date.now()
            };

            // PUSH TO 'pending_apps' NOT 'games'
            push(ref(db, 'pending_apps'), appData).then(() => {
                alert("App submitted for review successfully!");
                location.reload();
            });
        };
    </script>
</body>
</html>