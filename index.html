<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nexus Developer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #0f1014; color: #fff; font-family: 'Poppins', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        /* Reuse previous CSS for developer panel */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f1014; z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .auth-box { background: #1b1e26; padding: 40px; border-radius: 15px; width: 350px; text-align: center; border: 1px solid #333; }
        #dashboard { display: none; width: 100%; height: 100%; }
        .sidebar { width: 250px; background: #16181c; padding: 20px; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .menu-item { padding: 12px 15px; border-radius: 8px; color: #aaa; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }
        .menu-item:hover, .menu-item.active { background: #1f2229; color: white; }
        input, textarea, select { width: 100%; background: #0f1014; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; background: #00d4ff; color: black; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .file-upload { border: 2px dashed #444; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; margin-bottom: 15px; }
        .preview-img { height: 50px; margin-bottom: 10px; display: none; object-fit: contain; }
        .guideline-box { background: rgba(0, 200, 81, 0.1); border: 1px solid #00c851; color: #00c851; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>
    <!-- Auth and Dashboard Layout similar to previous Developer Panel code -->
    <!-- Ensure scripts include firebase config -->
    <div id="auth-screen"><div class="auth-box"><h2>Dev Portal</h2><div id="login-form"><input type="email" id="l-email" placeholder="Email"><input type="password" id="l-pass" placeholder="Password"><button class="btn" onclick="window.loginDev()">Log In</button><p onclick="window.toggleAuth()" style="font-size:12px;margin-top:15px;cursor:pointer;color:#aaa">Create Account</p></div><div id="signup-form" style="display:none"><input type="text" id="s-name" placeholder="Studio Name"><input type="email" id="s-email" placeholder="Email"><input type="password" id="s-pass" placeholder="Password"><button class="btn" onclick="window.createDev()">Sign Up</button><p onclick="window.toggleAuth()" style="font-size:12px;margin-top:15px;cursor:pointer;color:#aaa">Back to Login</p></div></div></div>

    <div id="dashboard">
        <div class="sidebar">
            <h3 style="color:#00d4ff; padding-left:15px;">Dev Console</h3>
            <div class="menu-item active" onclick="window.showView('submit')">Submit App</div>
            <div class="menu-item" onclick="window.showView('myapps')">My Apps</div>
            <div class="menu-item" onclick="window.showView('profile')">Profile</div>
            <div style="margin-top:auto"><button class="btn" style="background:#ff4757; color:white" onclick="window.logout()">Logout</button></div>
        </div>
        <div class="main">
            <div id="view-submit">
                <h1>Submit App</h1>
                <div class="guideline-box"><i class="fas fa-check-circle"></i><span>When you submit your app here, it will go to the Admin for review. If the Admin approves it, your app will be published on the Nexus Play Store.</span></div>
                <div style="background:#1b1e26; padding:30px; border-radius:15px; max-width:600px;">
                    <label>App Name</label><input type="text" id="appName">
                    <div style="display:flex; gap:10px;"><select id="appType"><option>Game</option><option>App</option></select><select id="appCat"><option>Action</option><option>Racing</option><option>RPG</option><option>Tools</option><option>Social</option></select></div>
                    <div style="display:flex; gap:10px;"><input id="appSize" placeholder="Size"><input id="appAge" placeholder="Age"></div>
                    <label>Pricing</label><select id="priceType" onchange="window.togglePrice()"><option value="Free">Free</option><option value="Paid">Paid</option></select><input type="text" id="appPrice" placeholder="Price" disabled style="display:none;">
                    <label>Icon</label><div class="file-upload" onclick="document.getElementById('iconFile').click()">Upload Icon</div><input type="file" id="iconFile" hidden accept="image/*" onchange="window.handleIcon(this)"><input type="hidden" id="iconBase64"><img id="iconPreview" class="preview-img">
                    <label>Download Link</label><input type="text" id="appLink" placeholder="URL">
                    <label>Video URL (Optional)</label><input type="text" id="appVideo" placeholder="YouTube Link">
                    <label>Description</label><textarea id="appDesc" rows="3"></textarea>
                    <label>Screenshots</label><div id="sc-container"></div><button class="btn" style="background:#333; margin-bottom:10px;" onclick="window.addScField()">+ Add Screenshot</button>
                    <button class="btn" id="btn-action" onclick="window.submitForReview()">SUBMIT FOR REVIEW</button>
                </div>
            </div>
            <div id="view-myapps" style="display:none;"><h1>My Apps</h1><div id="my-apps-list">Loading...</div></div>
            <div id="view-profile" style="display:none;"><h1>Profile</h1><div style="background:#1b1e26; padding:30px; border-radius:15px; max-width:500px;"><input type="text" id="edit-dev-name"><input type="text" id="edit-dev-email" disabled><button class="btn" onclick="window.saveDevProfile()">SAVE CHANGES</button></div></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        // CONFIG - PASTE YOURS
        const firebaseConfig = {
            apiKey: "AIzaSyCn1FBaxDwbvC28VWXAcq557uCidl-JHy0",
            authDomain: "app-store-6b5d4.firebaseapp.com",
            databaseURL: "https://app-store-6b5d4-default-rtdb.firebaseio.com",
            projectId: "app-store-6b5d4",
            storageBucket: "app-store-6b5d4.firebasestorage.app",
            messagingSenderId: "55022892860",
            appId: "1:55022892860:web:f48865da1539854bf8d039"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        let currentUser=null;

        onAuthStateChanged(auth, u => {
            if(u) { currentUser=u; document.getElementById('auth-screen').style.display='none'; document.getElementById('dashboard').style.display='flex'; document.getElementById('edit-dev-name').value=u.displayName; document.getElementById('edit-dev-email').value=u.email; loadMyApps(); } 
            else { document.getElementById('auth-screen').style.display='flex'; document.getElementById('dashboard').style.display='none'; }
        });

        window.toggleAuth=()=>{const l=document.getElementById('login-form'),s=document.getElementById('signup-form'); if(l.style.display==='none'){l.style.display='block';s.style.display='none'}else{l.style.display='none';s.style.display='block'}};
        window.loginDev=()=>signInWithEmailAndPassword(auth, document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e=>alert(e.message));
        window.createDev=()=>createUserWithEmailAndPassword(auth, document.getElementById('s-email').value, document.getElementById('s-pass').value).then(c=>updateProfile(c.user,{displayName:document.getElementById('s-name').value})).catch(e=>alert(e.message));
        window.logout=()=>signOut(auth);
        window.showView=(id)=>{['submit','myapps','profile'].forEach(v=>document.getElementById('view-'+v).style.display='none'); document.getElementById('view-'+id).style.display='block';};
        window.saveDevProfile=()=>updateProfile(currentUser,{displayName:document.getElementById('edit-dev-name').value}).then(()=>alert("Saved"));

        const compress=(f)=>new Promise(r=>{const rd=new FileReader();rd.readAsDataURL(f);rd.onload=e=>{const i=new Image();i.src=e.target.result;i.onload=()=>{const c=document.createElement('canvas'),s=500/i.width;c.width=500;c.height=i.height*s;c.getContext('2d').drawImage(i,0,0,c.width,c.height);r(c.toDataURL('image/jpeg',0.7))}}});
        window.handleIcon=async(i)=>{if(i.files[0]){const b=await compress(i.files[0]);document.getElementById('iconBase64').value=b;document.getElementById('iconPreview').src=b;document.getElementById('iconPreview').style.display='block';}};
        window.togglePrice=()=>{const t=document.getElementById('priceType').value;document.getElementById('appPrice').style.display=t==='Paid'?'block':'none';document.getElementById('appPrice').disabled=t!=='Paid';};
        window.addScField=()=>{const d=document.createElement('div');d.innerHTML=`<input type="file" class="sc-file" accept="image/*" onchange="window.handleSc(this)" style="margin-bottom:5px">`;document.getElementById('sc-container').appendChild(d);};
        window.handleSc=async(i)=>{if(i.files[0]){const b=await compress(i.files[0]);i.setAttribute('data-b64',b);i.style.border="1px solid #00d4ff";}};

        window.submitForReview=()=>{
            const data = {
                name: document.getElementById('appName').value,
                type: document.getElementById('appType').value,
                category: document.getElementById('appCat').value,
                size: document.getElementById('appSize').value||"N/A",
                age: document.getElementById('appAge').value||"3+",
                priceType: document.getElementById('priceType').value,
                price: document.getElementById('appPrice').value,
                logo: document.getElementById('iconBase64').value,
                download: document.getElementById('appLink').value,
                video: document.getElementById('appVideo').value, 
                desc: document.getElementById('appDesc').value,
                developer: currentUser.displayName,
                developerId: currentUser.uid,
                timestamp: Date.now(),
                status: "Pending"
            };
            const sc=[]; document.querySelectorAll('.sc-file').forEach(i=>{const v=i.getAttribute('data-b64');if(v)sc.push(v)});
            if(sc.length>0)data.screenshots=sc;
            if(!data.name||!data.download) return alert("Missing Name or Link");
            push(ref(db,'pending_apps'),data).then(()=>{alert("Submitted!");window.location.reload();});
        };
        
        function loadMyApps(){ if(!currentUser)return; onValue(ref(db,'pending_apps'),s1=>{const p=s1.val()||{}; onValue(ref(db,'games'),s2=>{const l=s2.val()||{}; renderMyApps(p,l); },{onlyOnce:true});}); }
        function renderMyApps(p,l){
            const list=document.getElementById('my-apps-list'); list.innerHTML="";
            const items=[];
            Object.entries(p).forEach(([k,v])=>{if(v.developerId===currentUser.uid)items.push({...v,status:'Pending'})});
            Object.entries(l).forEach(([k,v])=>{if(v.developerId===currentUser.uid)items.push({...v,status:'Live'})});
            items.forEach(a=>{ list.innerHTML+=`<div class="app-card"><img src="${a.logo}"><div class="app-info"><b>${a.name}</b><br><span class="app-status status-${a.status.toLowerCase()}">${a.status}</span></div></div>`; });
        }
    </script>
</body>
</html>